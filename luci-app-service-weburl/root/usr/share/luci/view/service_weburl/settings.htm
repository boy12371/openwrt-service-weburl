<%+header%>
<h2><%=page_title%></h2>

<form method="post" action="<%=url(is_edit and 'admin/services/update_service' or 'admin/services/add_service')%>" class="cbi-map">
    <% if is_edit then %>
    <input type="hidden" name="id" value="<%=service.id%>" />
    <% end %>
    
    <fieldset class="cbi-section">
        <div class="cbi-section-descr"><%:请填写服务详细信息%></div>
        
        <!-- 服务标题 -->
        <div class="cbi-value">
            <label class="cbi-value-title"><%:服务标题%></label>
            <div class="cbi-value-field">
                <input type="text" name="title" value="<%=is_edit and pcdata(service.title) or ''%>" 
                       required maxlength="100" class="cbi-input-text" id="service-title" />
                <div class="cbi-value-description"><%:不超过100个字符%></div>
            </div>
        </div>
        
        <!-- 服务URL -->
        <div class="cbi-value">
            <label class="cbi-value-title"><%:服务URL%></label>
            <div class="cbi-value-field">
                <input type="url" name="url" value="<%=is_edit and pcdata(service.url) or ''%>" 
                       required class="cbi-input-text" id="service-url" />
                <div class="cbi-value-description"><%:必须以http://或https://开头%></div>
            </div>
        </div>
        
        <!-- 服务描述 -->
        <div class="cbi-value">
            <label class="cbi-value-title"><%:服务描述%></label>
            <div class="cbi-value-field">
                <textarea name="description" rows="3" maxlength="500" class="cbi-input-textarea" 
                          id="service-description"><%=is_edit and pcdata(service.description) or ''%></textarea>
                <div class="cbi-value-description"><%:不超过500个字符%></div>
            </div>
        </div>
        
        <!-- 实时预览 -->
        <div class="cbi-value">
            <label class="cbi-value-title"><%:实时预览%></label>
            <div class="cbi-value-field">
                <div class="service-preview" id="service-preview">
                    <h3 id="preview-title"><%=is_edit and pcdata(service.title) or '服务标题'%></h3>
                    <p id="preview-description"><%=is_edit and pcdata(service.description) or '服务描述'%></p>
                    <a href="<%=is_edit and pcdata(service.url) or '#'%>" target="_blank" id="preview-link" class="btn"><%:访问服务%></a>
                </div>
            </div>
        </div>
    </fieldset>
    
    <div class="cbi-page-actions">
        <button type="submit" class="cbi-button cbi-button-apply"><%:保存%></button>
        <a href="<%=url('admin/services/index')%>" class="cbi-button cbi-button-reset"><%:取消%></a>
    </div>
</form>

<script type="text/javascript">
// 实时更新预览
function updatePreview() {
    var title = document.getElementById('service-title').value || '服务标题';
    var url = document.getElementById('service-url').value || '#';
    var description = document.getElementById('service-description').value || '服务描述';
    
    document.getElementById('preview-title').textContent = title;
    document.getElementById('preview-description').textContent = description;
    document.getElementById('preview-link').href = url;
}

// 表单验证
function validateForm() {
    var title = document.getElementById('service-title').value;
    var url = document.getElementById('service-url').value;
    
    if (!title || title.trim() === '') {
        alert('<%:服务标题不能为空%>');
        return false;
    }
    
    if (!url || url.trim() === '') {
        alert('<%:服务URL不能为空%>');
        return false;
    }
    
    if (!url.startsWith('http://') && !url.startsWith('https://')) {
        alert('<%:URL必须以http://或https://开头%>');
        return false;
    }
    
    return true;
}

// 绑定输入事件
document.getElementById('service-title').addEventListener('input', updatePreview);
document.getElementById('service-url').addEventListener('input', updatePreview);
document.getElementById('service-description').addEventListener('input', updatePreview);

// 表单提交验证
document.querySelector('form').addEventListener('submit', function(e) {
    if (!validateForm()) {
        e.preventDefault();
    }
});

// 初始化预览
updatePreview();
</script>

<%+footer%>