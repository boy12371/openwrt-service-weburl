<%+header%>

<script type="text/javascript">//<![CDATA[
    window.addEventListener('load', function() {
        loadServices();
    });

    function loadServices() {
        XHR.get('<%=luci.dispatcher.build_url("admin", "services", "service_weburl", "get_services")%>', null,
            function(x, data) {
                if (data) {
                    var serviceList = document.getElementById('service-list');
                    serviceList.innerHTML = '';
                    
                    data.forEach(function(service) {
                        var card = document.createElement('div');
                        card.className = 'service-card';
                        card.innerHTML = `
                            <div class="service-header">
                                <h3>${htmlEscape(service.title)}</h3>
                                <div class="service-actions">
                                    <button onclick="editService(${service.id})" class="btn cbi-button cbi-button-edit"><%:Edit%></button>
                                    <button onclick="deleteService(${service.id})" class="btn cbi-button cbi-button-remove"><%:Delete%></button>
                                </div>
                            </div>
                            <div class="service-content">
                                <p>${htmlEscape(service.description || '')}</p>
                                <a href="${htmlEscape(service.url)}" target="_blank" class="service-link">${htmlEscape(service.url)}</a>
                            </div>
                        `;
                        serviceList.appendChild(card);
                    });
                }
            }
        );
    }

    function htmlEscape(str) {
        return String(str)
            .replace(/&/g, '&amp;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
    }

    function deleteService(id) {
        if (confirm('<%:Are you sure you want to delete this service?%>')) {
            XHR.post('<%=luci.dispatcher.build_url("admin", "services", "service_weburl", "delete_service")%>', 
                { id: id },
                function(x, data) {
                    if (data && data.success) {
                        loadServices();
                    } else {
                        alert('<%:Failed to delete service%>');
                    }
                }
            );
        }
    }

    function editService(id) {
        window.location.href = '<%=luci.dispatcher.build_url("admin", "services", "service_weburl", "add")%>?id=' + id;
    }
//]]></script>

<style>
.service-card {
    background: #fff;
    border: 1px solid #e6e6e6;
    border-radius: 4px;
    margin-bottom: 1em;
    padding: 1em;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.service-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5em;
}

.service-header h3 {
    margin: 0;
}

.service-actions {
    display: flex;
    gap: 0.5em;
}

.service-content {
    color: #666;
}

.service-link {
    display: inline-block;
    margin-top: 0.5em;
    color: #0066cc;
    text-decoration: none;
}

.service-link:hover {
    text-decoration: underline;
}

.add-service-btn {
    margin-bottom: 1em;
}
</style>

<h2><%:Service WebURL%></h2>

<div class="cbi-map">
    <div class="cbi-section">
        <div class="add-service-btn">
            <a href="<%=luci.dispatcher.build_url("admin", "services", "service_weburl", "add")%>" class="btn cbi-button cbi-button-add"><%:Add New Service%></a>
        </div>
        <div id="service-list">
            <em><%:Loading...%></em>
        </div>
    </div>
</div>

<%+footer%>